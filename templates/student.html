<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Dashboard — Performance Analytics</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --text-light: #e2e8f0;
      --muted: #94a3b8;
      --accent1: #6366f1;
      --accent2: #ec4899;
      --accent3: #10b981;
      --accent4: #f59e0b;
      --danger: #ef4444;
      --warning: #f59e0b;
      font-family: 'Poppins', sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-light);
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #111827;
      display: flex;
      flex-direction: column;
      padding: 20px 10px;
    }
    .sidebar h2 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
      color: #fff;
    }
    .term-nav a {
      display: block;
      padding: 12px 16px;
      margin: 8px 0;
      border-radius: 8px;
      text-decoration: none;
      color: var(--muted);
      transition: 0.2s;
      cursor: pointer;
    }
    .term-nav a.active, .term-nav a:hover {
      background: var(--accent1);
      color: #fff;
    }

    /* Main */
    .main {
      flex: 1;
      padding: 20px 28px;
      display: flex;
      flex-direction: column;
    }

    .top-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: 0.3s;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .card:hover { transform: translateY(-4px); }
    .card h3 { margin: 0; font-size: 16px; }
    .card .value { font-size: 26px; font-weight: 700; }
    .card .desc { font-size: 13px; color: var(--muted); }

    .card:nth-child(1) { background: linear-gradient(135deg, #6366f1, #3b82f6); }
    .card:nth-child(2) { background: linear-gradient(135deg, #ec4899, #db2777); }
    .card:nth-child(3) { background: linear-gradient(135deg, #10b981, #059669); }
    .card:nth-child(4) { background: linear-gradient(135deg, #f59e0b, #d97706); }

    /* Chart container */
    .chart-box {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    header input {
      padding: 10px 12px;
      background: #1e293b;
      border: none;
      border-radius: 8px;
      color: var(--text-light);
      width: 260px;
      outline: none;
    }

    /* Flash messages */
    .flash-messages {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      max-width: 400px;
    }
    .flash-message {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .flash-message.success {
      background: var(--accent3);
      color: #021;
    }
    .flash-message.error {
      background: var(--danger);
      color: white;
    }
    .flash-message.info {
      background: var(--accent1);
      color: white;
    }

    /* Recommendations section */
    .recommendations {
      margin-top: 20px;
    }
    .recommendation-card {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      border-left: 4px solid var(--accent3);
    }
    .recommendation-card.warning {
      border-left-color: var(--warning);
    }
    .recommendation-card.danger {
      border-left-color: var(--danger);
    }
    .recommendation-card h4 {
      margin: 0 0 8px 0;
      color: var(--accent3);
    }
    .recommendation-card.warning h4 {
      color: var(--warning);
    }
    .recommendation-card.danger h4 {
      color: var(--danger);
    }
    .recommendation-card p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
    }

    /* Logout button */
    .logout-btn {
      background: transparent;
      border: 1px solid var(--muted);
      color: var(--muted);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }
    .logout-btn:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    /* Performance factors */
    .factors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .factor-card {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 20px;
    }
    .factor-card h4 {
      margin: 0 0 12px 0;
      color: var(--accent1);
      font-size: 14px;
    }
    .factor-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .factor-desc {
      font-size: 12px;
      color: var(--muted);
    }

    /* Analytics charts */
    .analytics-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .analytics-card {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 20px;
      height: 300px;
      margin-bottom: 20px;
    }
    .analytics-card h4 {
      margin: 0 0 12px 0;
      color: var(--accent1);
    }

    /* Comparison section */
    .comparison-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }
    .comparison-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    .comparison-item {
      text-align: center;
      padding: 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    .comparison-value {
      font-size: 20px;
      font-weight: 700;
      margin: 8px 0;
    }
    .comparison-label {
      font-size: 12px;
      color: var(--muted);
    }

    /* Hidden sections */
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Flash Messages -->
  <div class="flash-messages">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <aside class="sidebar">
    <h2>Student Portal</h2>
    <div class="term-nav">
      <a href="#" class="active" data-section="overview">Performance Overview</a>
      <a href="#" data-section="day">Performance by Day</a>
      <a href="#" data-section="teacher">Performance by Teacher</a>
      <a href="#" data-section="topic">Performance by Topic</a>
      <a href="#" data-section="subject">Subject Comparison</a>
      <a href="#" data-section="comparison">Comparison</a>
    </div>
    <div style="margin-top: auto; padding: 16px;">
      <button class="logout-btn" onclick="window.location.href='{{ url_for('logout') }}'">Logout</button>
    </div>
  </aside>

  <main class="main">
    <header>
      <div>
        <h1>Welcome, {{ student.full_name.split(' ')[0] }}</h1>
        <div style="font-size:14px;color:var(--muted)">Student ID: {{ student.student_id }} • {{ student.grade_level }}</div>
      </div>
      <div style="display:flex;gap:12px;align-items:center">
        <input type="text" placeholder="Search topics, grades..." id="searchInput" />
        <div class="export-options">
          <button class="export-btn" data-report="student_progress">Progress Report</button>
          <button class="export-btn" data-report="performance_summary">Grade Summary</button>
        </div>
      </div>
    </header>

    <!-- OVERVIEW SECTION -->
    <section id="overview-section" class="dashboard-section">
      <section class="top-cards">
        <div class="card">
          <h3>Overall Average</h3>
          <div class="value">82%</div>
          <div class="desc">+2% from last month</div>
        </div>
        <div class="card">
          <h3>Mathematics</h3>
          <div class="value">78%</div>
          <div class="desc">Consistent performance</div>
        </div>
        <div class="card">
          <h3>English</h3>
          <div class="value">85%</div>
          <div class="desc">Strong improvement</div>
        </div>
        <div class="card">
          <h3>Best Performance</h3>
          <div class="value">92%</div>
          <div class="desc">In Composition</div>
        </div>
      </section>

      <section class="chart-box">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
          <h2>Your Performance Overview</h2>
          <div class="export-options">
            <button class="export-btn" id="refreshData">Refresh Data</button>
            <button class="export-btn" id="exportChartData">Export Chart Data</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="performanceChart"></canvas>
        </div>
      </section>

      <section class="recommendations">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
          <h3>Personalized Learning Recommendations</h3>
          <button class="export-btn" id="refreshRecommendations">Refresh Recommendations</button>
        </div>
        <div id="recommendations-container">
          <div class="recommendation-card">
            <h4>FOCUS ON GRAMMAR</h4>
            <p>Your grammar scores are 15% below your average. Consider practicing with grammar exercises twice a week.</p>
          </div>
          <div class="recommendation-card">
            <h4>STUDY SCHEDULE OPTIMIZATION</h4>
            <p>You perform best on Wednesdays. Schedule your most challenging subjects for mid-week study sessions.</p>
          </div>
          <div class="recommendation-card">
            <h4>TEACHER ENGAGEMENT</h4>
            <p>You achieve better results with Mr. Kamau. Consider attending his extra help sessions regularly.</p>
          </div>
        </div>
      </section>
    </section>

    <!-- PERFORMANCE BY DAY SECTION -->
    <section id="day-section" class="dashboard-section hidden">
      <section class="chart-box">
        <h2>Performance by Day</h2>
        <div class="chart-container">
          <canvas id="dayChart"></canvas>
        </div>
        <div class="data-summary">
          <strong>Analysis:</strong> Your performance peaks on Wednesdays with an average score of 88%. 
          Mondays show the lowest performance at 75%. Consider distributing study load more evenly.
        </div>
      </section>
    </section>

    <!-- PERFORMANCE BY TEACHER SECTION -->
    <section id="teacher-section" class="dashboard-section hidden">
      <section class="chart-box">
        <h2>Performance by Teacher</h2>
        <div class="chart-container">
          <canvas id="teacherChart"></canvas>
        </div>
        <div class="data-summary">
          <strong>Analysis:</strong> Mr. Kamau's teaching style appears most effective for you with 87% average. 
          Mrs. Moraa's classes show room for improvement at 76%.
        </div>
      </section>
    </section>

    <!-- PERFORMANCE BY TOPIC SECTION -->
    <section id="topic-section" class="dashboard-section hidden">
      <section class="chart-box">
        <h2>Performance by Topic</h2>
        <div class="chart-container">
          <canvas id="topicChart"></canvas>
        </div>
        <div class="data-summary">
          <strong>Analysis:</strong> Composition is your strongest area (92%) while Grammar needs attention (68%). 
          Algebra shows steady improvement from last term.
        </div>
      </section>
    </section>

    <!-- SUBJECT COMPARISON SECTION -->
    <section id="subject-section" class="dashboard-section hidden">
      <section class="chart-box">
        <h2>Subject Comparison</h2>
        <div class="chart-container">
          <canvas id="subjectChart"></canvas>
        </div>
        <div class="data-summary">
          <strong>Analysis:</strong> English leads with 85% average, while Mathematics follows at 78%. 
          Both subjects show positive growth trends this semester.
        </div>
      </section>
    </section>

    <!-- COMPARISON SECTION -->
    <section id="comparison-section" class="dashboard-section hidden">
      <section class="comparison-section">
        <h2>Performance Comparison</h2>
        <div class="comparison-grid">
          <div class="comparison-item">
            <h4>Best Performing Day</h4>
            <div class="comparison-value">Wednesday</div>
            <div class="comparison-label">Your most productive day for learning</div>
          </div>
          <div class="comparison-item">
            <h4>Most Effective Teacher</h4>
            <div class="comparison-value">Mr. Kamau</div>
            <div class="comparison-label">Teacher with best results for you</div>
          </div>
          <div class="comparison-item">
            <h4>Strongest Topic</h4>
            <div class="comparison-value">Composition</div>
            <div class="comparison-label">Your best performing subject area</div>
          </div>
          <div class="comparison-item">
            <h4>Improvement Area</h4>
            <div class="comparison-value">Grammar</div>
            <div class="comparison-label">Topic needing more attention</div>
          </div>
        </div>
      </section>
    </section>
  </main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Student dashboard loading...');
        initializeStudentDashboard();
        setupNavigation();
    });

    function setupNavigation() {
        const navLinks = document.querySelectorAll('.term-nav a');
        const sections = document.querySelectorAll('.dashboard-section');
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                navLinks.forEach(l => l.classList.remove('active'));
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all sections
                sections.forEach(section => section.classList.add('hidden'));
                
                // Show selected section
                const sectionId = this.getAttribute('data-section') + '-section';
                document.getElementById(sectionId).classList.remove('hidden');
                
                // Initialize chart for the section if needed
                initializeSectionChart(this.getAttribute('data-section'));
            });
        });
    }

    function initializeSectionChart(section) {
        switch(section) {
            case 'day':
                createDayChart();
                break;
            case 'teacher':
                createTeacherChart();
                break;
            case 'topic':
                createTopicChart();
                break;
            case 'subject':
                createSubjectChart();
                break;
            case 'overview':
                createMainPerformanceChart();
                break;
        }
    }

    function initializeStudentDashboard() {
        // Initialize all charts
        createMainPerformanceChart();
        createDayChart();
        createTeacherChart();
        createTopicChart();
        createSubjectChart();
    }

    function createMainPerformanceChart() {
        const ctx = document.getElementById('performanceChart');
        if (!ctx) return;

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Your Performance',
                    data: [75, 78, 82, 80, 85, 82],
                    tension: 0.4,
                    borderWidth: 2,
                    fill: true,
                    backgroundColor: 'rgba(99,102,241,0.1)',
                    borderColor: 'rgba(99,102,241,0.8)',
                    pointBackgroundColor: 'rgba(99,102,241,1)',
                    pointBorderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { 
                        grid: { color: '#1e293b' },
                        ticks: { color: '#94a3b8' }
                    },
                    y: {
                        grid: { color: '#1e293b' },
                        ticks: { color: '#94a3b8' },
                        min: 0,
                        max: 100
                    }
                }
            }
        });
    }

    function createDayChart() {
        const ctx = document.getElementById('dayChart');
        if (!ctx) return;

        const data = { Monday: 75, Tuesday: 82, Wednesday: 88, Thursday: 80, Friday: 76 };
        const labels = Object.keys(data);
        const values = Object.values(data);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Average Score',
                    data: values,
                    backgroundColor: 'rgba(99,102,241,0.8)',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
    }

    function createTeacherChart() {
        const ctx = document.getElementById('teacherChart');
        if (!ctx) return;

        const data = { 'Mr. Kamau': 87, 'Mrs. Moraa': 76, 'Mr. Njoroge': 81 };
        const labels = Object.keys(data);
        const values = Object.values(data);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Average Score',
                    data: values,
                    backgroundColor: 'rgba(236,72,153,0.8)',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
    }

    function createTopicChart() {
        const ctx = document.getElementById('topicChart');
        if (!ctx) return;

        const data = { Composition: 92, 'Reading Comprehension': 85, Algebra: 78, Geometry: 75, Grammar: 68 };
        const labels = Object.keys(data);
        const values = Object.values(data);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Average Score',
                    data: values,
                    backgroundColor: 'rgba(16,185,129,0.8)',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                indexAxis: 'y'
            }
        });
    }

    function createSubjectChart() {
        const ctx = document.getElementById('subjectChart');
        if (!ctx) return;

        const data = { Mathematics: 78, English: 85, Science: 80, History: 82 };
        const labels = Object.keys(data);
        const values = Object.values(data);

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: [
                        'rgba(99,102,241,0.8)', 
                        'rgba(236,72,153,0.8)',
                        'rgba(16,185,129,0.8)',
                        'rgba(245,158,11,0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    }
</script>
</body>
</html>
